#!/bin/sh

# This script launches React Native package manager when running in debug mode

UFS_ROOT="$PROJECT_DIR/../node_modules/ufs-mobile-platform"

# Import global constants
source "$UFS_ROOT/config/constants.sh"

if [ "$CONFIGURATION" != "$UFS_DEBUG_CONFIG" ]; then
    exit 0
fi

# Check if 8081 is reachable
if nc -w 5 -z localhost 8081 ; then
    # Check status of 8081
    status=$(curl -s "http://localhost:8081/status")
    if [ "$status" != "packager-status:running" ] ; then
        echo "Port 8081 already in use, packager is either not running or not running correctly"
        exit 2
    fi
else
    # Open new instance of package manager
    open "$SRCROOT/../node_modules/ufs-mobile-platform/config/actualLaunchPackager.command" || echo "Can't start packager automatically"
fi
