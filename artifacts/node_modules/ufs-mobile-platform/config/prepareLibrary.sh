#!/bin/sh

# This script launches React Native package manager when running in debug mode

UFS_ROOT="$PROJECT_DIR/../node_modules/ufs-mobile-platform"

# Import global constants
source "$UFS_ROOT/config/constants.sh"

binaryPath="$UFS_ROOT/$UFS_REL_FRAMEWORK_BINARY_PATH"
debugBinaryPath="$UFS_ROOT/$UFS_REL_FRAMEWORK_DEBUG_BINARY_PATH"
releaseBinaryPath="$UFS_ROOT/$UFS_REL_FRAMEWORK_RELEASE_BINARY_PATH"

if [ ! -f "$binaryPath" ]; then
    echo "Corrupt library binary. Reinstall npm package."
    exit 1
fi

if [ "$CONFIGURATION" == "$UFS_DEBUG_CONFIG" ]; then
    if [ -f "$debugBinaryPath" ]; then
        # currently using release binary, swap to debug
        mv -n "$binaryPath" "$releaseBinaryPath"
        mv -n "$debugBinaryPath" "$binaryPath"
    elif [ ! -f "$releaseBinaryPath" ]; then
        echo "Corrupt library binary. Reinstall npm package."
        exit 1
    fi
elif [ "$CONFIGURATION" == "$UFS_RELEASE_CONFIG" ]; then
    if [ -f "$releaseBinaryPath" ]; then
        # currently using debug binary, swap to release
        mv -n "$binaryPath" "$debugBinaryPath"
        mv -n "$releaseBinaryPath" "$binaryPath"
    elif [ ! -f "$debugBinaryPath" ]; then
        echo "Corrupt library binary. Reinstall npm package."
        exit 1
    fi
fi
